// Mock data for the Escape Placement Cell game

export const aptitudeQuestions = [
  {
    id: 1,
    question:
      "If the selling price of 15 articles equals the cost price of 20 articles, find the gain %.",
    options: ["25%", "30%", "33.33%", "35%"],
    correctAnswer: 2,
  },
  {
    id: 2,
    question:
      "A train running at 60 km/hr crosses a pole in 9 seconds. Find its length.",
    options: ["120 m", "150 m", "180 m", "200 m"],
    correctAnswer: 1,
  },
  {
    id: 3,
    question:
      "What is the simple interest on ₹10,000 at 12% per annum for 2 years?",
    options: ["₹2200", "₹2400", "₹2500", "₹2600"],
    correctAnswer: 1,
  },
  {
    id: 4,
    question: "If A = 2 and B = 3, then (A³ + B³)/(A + B) = ?",
    options: ["5", "6", "7", "8"],
    correctAnswer: 2,
  },
  {
    id: 5,
    question:
      "The sum of two numbers is 45 and their difference is 9. Find the larger number.",
    options: ["18", "24", "27", "30"],
    correctAnswer: 2,
  },
  {
    id: 6,
    question: "What is 20% of 25% of 400?",
    options: ["15", "18", "20", "25"],
    correctAnswer: 2,
  },
  {
    id: 7,
    question:
      "A can finish work in 12 days, B in 18 days. Working together they complete it in:",
    options: ["6 days", "7 days", "7.2 days", "8 days"],
    correctAnswer: 2,
  },
  {
    id: 8,
    question: "HCF of 24, 36, and 60 is:",
    options: ["6", "8", "10", "12"],
    correctAnswer: 3,
  },
  {
    id: 9,
    question:
      "A person covers 60 km at 30 km/hr and returns at 20 km/hr. Find average speed.",
    options: ["22 km/hr", "24 km/hr", "25 km/hr", "26 km/hr"],
    correctAnswer: 1,
  },
  {
    id: 10,
    question:
      "A man's age is 3 times his son's. After 10 years, he'll be twice his son's. Find father's age.",
    options: ["25", "28", "30", "33"],
    correctAnswer: 2,
  },
  {
    id: 11,
    question: "If 4 pencils cost ₹20, cost of 10 pencils is:",
    options: ["₹40", "₹45", "₹50", "₹55"],
    correctAnswer: 2,
  },
  {
    id: 12,
    question: "Find the next term: 3, 9, 27, 81, ?",
    options: ["121", "243", "162", "324"],
    correctAnswer: 1,
  },
  {
    id: 13,
    question: "Probability of picking a blue ball from 4 red, 5 blue, 3 green?",
    options: ["1/3", "5/12", "1/4", "5/10"],
    correctAnswer: 1,
  },
  {
    id: 14,
    question: "Compound interest on ₹5000 at 10% for 2 years = ?",
    options: ["₹1000", "₹1050", "₹1100", "₹1150"],
    correctAnswer: 1,
  },
  {
    id: 15,
    question:
      "The ratio of two numbers is 3:4, their sum is 84. Smaller number = ?",
    options: ["28", "32", "36", "40"],
    correctAnswer: 2,
  },
  {
    id: 16,
    question: "Simplify: 2³ × 2⁴ / 2² = ?",
    options: ["8", "16", "32", "64"],
    correctAnswer: 2,
  },
  {
    id: 17,
    question:
      "8 workers complete a task in 6 days. 12 workers will complete it in:",
    options: ["3 days", "4 days", "5 days", "6 days"],
    correctAnswer: 1,
  },
  {
    id: 18,
    question: "Perimeter of square is 48 cm. Find area.",
    options: ["120 cm²", "132 cm²", "144 cm²", "156 cm²"],
    correctAnswer: 2,
  },
  {
    id: 19,
    question: "Find the next term: 7, 14, 28, 56, ?",
    options: ["84", "98", "112", "120"],
    correctAnswer: 2,
  },
  {
    id: 20,
    question: "If cost price = ₹500 and profit = 25%, selling price = ?",
    options: ["₹600", "₹625", "₹650", "₹700"],
    correctAnswer: 1,
  },
  {
    id: 21,
    question: "Find the odd one: 2, 6, 12, 20, 30, 42",
    options: ["20", "30", "42", "12"],
    correctAnswer: 1,
  },
  {
    id: 22,
    question: "If CAT = 24, DOG = 26, then BAT = ?",
    options: ["22", "23", "24", "25"],
    correctAnswer: 1,
  },
  {
    id: 23,
    question:
      "Arrange logically: Doctor, Patient, Diagnosis, Medicine, Recovery",
    options: [
      "Patient–Doctor–Diagnosis–Medicine–Recovery",
      "Doctor–Patient–Medicine–Diagnosis–Recovery",
      "Diagnosis–Doctor–Patient–Medicine–Recovery",
      "Doctor–Medicine–Patient–Recovery–Diagnosis",
    ],
    correctAnswer: 0,
  },
  {
    id: 24,
    question: "If A+B=12 and A–B=4, find A.",
    options: ["6", "7", "8", "9"],
    correctAnswer: 2,
  },
  {
    id: 25,
    question: "If all roses are flowers and some flowers fade, conclusion?",
    options: ["All roses fade", "Some roses fade", "No roses fade", "None"],
    correctAnswer: 1,
  },
  {
    id: 26,
    question: "Series: 3, 6, 18, 72, 360, ?",
    options: ["720", "1080", "1440", "2160"],
    correctAnswer: 3,
  },
  {
    id: 27,
    question:
      "Statements: All cats are animals. Some animals are dogs. Conclusion: Some cats are dogs.",
    options: ["True", "False", "Can't say", "Both"],
    correctAnswer: 1,
  },
  {
    id: 28,
    question: "Mirror of 2:30 = ?",
    options: ["9:30", "10:30", "8:30", "11:30"],
    correctAnswer: 0,
  },
  {
    id: 29,
    question: "If NORTH=45678, SOUTH=85678, find SNOTH.",
    options: ["845678", "846578", "845768", "845687"],
    correctAnswer: 0,
  },
  {
    id: 30,
    question: "If RAM=27, find RAVI. (R=18, A=1, V=22, I=9)",
    options: ["48", "49", "50", "51"],
    correctAnswer: 2,
  },
  {
    id: 31,
    question:
      "Pointing to a man, Rina said, 'He is my father's only son.' Who is he to Rina?",
    options: ["Father", "Brother", "Uncle", "Cousin"],
    correctAnswer: 1,
  },
  {
    id: 32,
    question: "Series: A, C, F, J, O, ?",
    options: ["S", "T", "U", "V"],
    correctAnswer: 2,
  },
  {
    id: 33,
    question: "Two typists type 10 pages in 2 min. How many in 6 min?",
    options: ["30", "40", "50", "60"],
    correctAnswer: 3,
  },
  {
    id: 34,
    question: "5 cats kill 5 rats in 5 min. 10 cats kill 10 rats in:",
    options: ["2.5 min", "5 min", "10 min", "15 min"],
    correctAnswer: 1,
  },
  {
    id: 35,
    question: "Odd one: Mango, Banana, Apple, Carrot",
    options: ["Mango", "Apple", "Carrot", "Banana"],
    correctAnswer: 2,
  },
  {
    id: 36,
    question: "If 1=3, 2=3, 3=5, 4=4, 5=4, then 6=?",
    options: ["3", "4", "5", "6"],
    correctAnswer: 0,
  },
  {
    id: 37,
    question:
      "If some pens are pencils and all pencils are erasers, all pens are erasers?",
    options: ["Yes", "No", "Possible", "None"],
    correctAnswer: 2,
  },
  {
    id: 38,
    question:
      "Ravi is older than Mohan but younger than Suresh. Who’s youngest?",
    options: ["Ravi", "Mohan", "Suresh", "Can't say"],
    correctAnswer: 1,
  },
  {
    id: 39,
    question: "If code for 'APPLE' is 'EQQPI', code for 'MANGO'?",
    options: ["QERKS", "QEPLS", "QERKT", "QERKS"],
    correctAnswer: 0,
  },
  {
    id: 40,
    question: "Which number should replace question mark? 8, 16, 32, ?, 128",
    options: ["48", "56", "64", "72"],
    correctAnswer: 2,
  },
  {
    id: 41,
    question: "Correct spelling:",
    options: ["Accomodate", "Acommodate", "Accommodate", "Accomadate"],
    correctAnswer: 2,
  },
  {
    id: 42,
    question: "Synonym of 'Benevolent':",
    options: ["Kind", "Evil", "Selfish", "Greedy"],
    correctAnswer: 0,
  },
  {
    id: 43,
    question: "Antonym of 'Hostile':",
    options: ["Angry", "Rude", "Friendly", "Cruel"],
    correctAnswer: 2,
  },
  {
    id: 44,
    question: "Fill in the blank: She is interested ___ painting.",
    options: ["on", "of", "in", "with"],
    correctAnswer: 2,
  },
  {
    id: 45,
    question: "Correct sentence:",
    options: [
      "He do not like mangoes.",
      "He does not likes mangoes.",
      "He does not like mangoes.",
      "He not like mangoes.",
    ],
    correctAnswer: 2,
  },
  {
    id: 46,
    question: "Find error: 'Each of the boys have done their homework.'",
    options: ["Each", "have", "their", "homework"],
    correctAnswer: 1,
  },
  {
    id: 47,
    question: "Passive voice of 'They built a bridge.'",
    options: [
      "A bridge built by them.",
      "A bridge was built by them.",
      "They had built a bridge.",
      "A bridge has built.",
    ],
    correctAnswer: 1,
  },
  {
    id: 48,
    question: "Indirect speech: He said, 'I am tired.'",
    options: [
      "He said he is tired.",
      "He said that he was tired.",
      "He said that I was tired.",
      "He told he tired.",
    ],
    correctAnswer: 1,
  },
  {
    id: 49,
    question: "One word: 'A person who writes poems.'",
    options: ["Novelist", "Poet", "Author", "Writer"],
    correctAnswer: 1,
  },
  {
    id: 50,
    question: "Preposition: He is fond ___ music.",
    options: ["at", "to", "of", "in"],
    correctAnswer: 2,
  },
  {
    id: 51,
    question: "Opposite of 'Ancient':",
    options: ["Antique", "Modern", "Old", "Medieval"],
    correctAnswer: 1,
  },
  {
    id: 52,
    question: "Correct spelling:",
    options: ["Embarass", "Embarrass", "Embaras", "Embaras"],
    correctAnswer: 1,
  },
  {
    id: 53,
    question: "Fill in: She is the ___ of all her friends.",
    options: ["tall", "taller", "tallest", "more tall"],
    correctAnswer: 2,
  },
  {
    id: 54,
    question: "Synonym of 'Vanish':",
    options: ["Hide", "Disappear", "Lose", "Cover"],
    correctAnswer: 1,
  },
  {
    id: 55,
    question: "Antonym of 'Expand':",
    options: ["Increase", "Extend", "Contract", "Stretch"],
    correctAnswer: 2,
  },
  {
    id: 56,
    question: "Choose correct tense: By next year, I ___ my degree.",
    options: [
      "complete",
      "have completed",
      "will complete",
      "will have completed",
    ],
    correctAnswer: 3,
  },
  {
    id: 57,
    question: "Find error: 'He is senior than me.'",
    options: ["is", "senior", "than", "me"],
    correctAnswer: 2,
  },
  {
    id: 58,
    question: "Idiom 'Hit the sack' means:",
    options: ["Start working", "Go to sleep", "Argue", "Pack things"],
    correctAnswer: 1,
  },
  {
    id: 59,
    question: "Correct usage:",
    options: [
      "She sings good.",
      "She sings well.",
      "She good sings.",
      "She sings nicely good.",
    ],
    correctAnswer: 1,
  },
  {
    id: 60,
    question: "Rearrange: 'holiday / spent / we / beach / the / on / the.'",
    options: [
      "We the beach spent on holiday.",
      "We spent the holiday on the beach.",
      "On the beach we the holiday spent.",
      "The beach we spent on holiday.",
    ],
    correctAnswer: 1,
  },
];
export const codingChallenges = {
  python: {
    problem: `Write a function that returns the factorial of a given number.

Example:
factorial(5) should return 120
factorial(0) should return 1

Requirements:
- Handle edge case for 0
- Use recursive or iterative approach
- Return the factorial as a number`,
    starterCode: `def factorial(n):
    # Your code here
    pass

# Test cases
print(factorial(5))  # Should output: 120
print(factorial(0))  # Should output: 1
print(factorial(3))  # Should output: 6`,
    testCases: [
      { input: 5, expected: 120, description: "factorial(5) = 120" },
      { input: 0, expected: 1, description: "factorial(0) = 1" },
      { input: 3, expected: 6, description: "factorial(3) = 6" },
    ],
  },
  javascript: {
    problem: `Write a function that checks if a string is a palindrome.

Example:
isPalindrome("racecar") should return true
isPalindrome("hello") should return false

Requirements:
- Ignore case sensitivity
- Ignore spaces and punctuation
- Return boolean value`,
    starterCode: `function isPalindrome(str) {
    // Your code here
}

// Test cases
console.log(isPalindrome("racecar"));  // Should output: true
console.log(isPalindrome("hello"));    // Should output: false
console.log(isPalindrome("A man a plan a canal Panama"));  // Should output: true`,
    testCases: [
      {
        input: "racecar",
        expected: true,
        description: "isPalindrome('racecar') = true",
      },
      {
        input: "hello",
        expected: false,
        description: "isPalindrome('hello') = false",
      },
      {
        input: "A man a plan a canal Panama",
        expected: true,
        description: "isPalindrome('A man a plan a canal Panama') = true",
      },
    ],
  },
  java: {
    problem: `Write a method that finds the maximum element in an array.

Example:
findMax([1, 5, 3, 9, 2]) should return 9
findMax([-1, -5, -3]) should return -1

Requirements:
- Handle empty array (return appropriate value)
- Use iterative approach
- Return the maximum integer`,
    starterCode: `public class Main {
    public static int findMax(int[] arr) {
        // Your code here
        return 0;
    }

    public static void main(String[] args) {
        // Test cases
        System.out.println(findMax(new int[]{1, 5, 3, 9, 2}));  // Should output: 9
        System.out.println(findMax(new int[]{-1, -5, -3}));      // Should output: -1
    }
}`,
    testCases: [
      {
        input: [1, 5, 3, 9, 2],
        expected: 9,
        description: "findMax([1, 5, 3, 9, 2]) = 9",
      },
      {
        input: [-1, -5, -3],
        expected: -1,
        description: "findMax([-1, -5, -3]) = -1",
      },
      { input: [42], expected: 42, description: "findMax([42]) = 42" },
    ],
  },
  cpp: {
    problem: `Write a function that returns the factorial of a given number.

Example:
factorial(5) should return 120
factorial(0) should return 1

Requirements:
- Handle edge case for 0
- Use recursive or iterative approach
- Return the factorial as a number`,
    starterCode: `#include <iostream>
using namespace std;

int factorial(int n) {
    // Your code here
    return 0;
}

int main() {
    // Test cases
    cout << factorial(5) << endl;  // Should output: 120
    cout << factorial(0) << endl;  // Should output: 1
    cout << factorial(3) << endl;  // Should output: 6
    return 0;
}`,
    testCases: [
      { input: 5, expected: 120, description: "factorial(5) = 120" },
      { input: 0, expected: 1, description: "factorial(0) = 1" },
      { input: 3, expected: 6, description: "factorial(3) = 6" },
    ],
  },
  c: {
    problem: `Write a function that returns the factorial of a given number.

Example:
factorial(5) should return 120
factorial(0) should return 1

Requirements:
- Handle edge case for 0
- Use recursive or iterative approach
- Return the factorial as a number`,
    starterCode: `#include <stdio.h>

int factorial(int n) {
    // Your code here
    return 0;
}

int main() {
    // Test cases
    printf("%d\\n", factorial(5));  // Should output: 120
    printf("%d\\n", factorial(0));  // Should output: 1
    printf("%d\\n", factorial(3));  // Should output: 6
    return 0;
}`,
    testCases: [
      { input: 5, expected: 120, description: "factorial(5) = 120" },
      { input: 0, expected: 1, description: "factorial(0) = 1" },
      { input: 3, expected: 6, description: "factorial(3) = 6" },
    ],
  },
};

export const interviewQuestions = [
  {
    id: 1,
    question: "Tell me about yourself and your background in computer science.",
    type: "behavioral",
    expectedKeywords: ["education", "experience", "skills", "projects"],
  },
  {
    id: 2,
    question: "What programming languages are you proficient in?",
    type: "technical",
    expectedKeywords: ["java", "python", "javascript", "c++", "sql"],
  },
  {
    id: 3,
    question:
      "Explain the difference between object-oriented and functional programming.",
    type: "technical",
    expectedKeywords: ["objects", "classes", "functions", "immutable", "state"],
  },
  {
    id: 4,
    question:
      "Describe a challenging project you worked on and how you overcame difficulties.",
    type: "behavioral",
    expectedKeywords: ["challenge", "solution", "teamwork", "learning"],
  },
  {
    id: 5,
    question: "What is your approach to debugging code?",
    type: "technical",
    expectedKeywords: ["logs", "breakpoints", "testing", "isolation"],
  },
  {
    id: 6,
    question: "How do you stay updated with technology trends?",
    type: "behavioral",
    expectedKeywords: ["blogs", "courses", "communities", "practice"],
  },
  {
    id: 7,
    question: "Explain the concept of time complexity and space complexity.",
    type: "technical",
    expectedKeywords: ["big o", "algorithm", "efficiency", "scalability"],
  },
  {
    id: 8,
    question:
      "Tell me about a time when you had to learn a new technology quickly.",
    type: "behavioral",
    expectedKeywords: ["learning", "deadline", "resources", "adaptation"],
  },
];

export const firstInterviewQuestion = interviewQuestions[0];

export const getRandomAptitudeQuestions = (count = 10) => {
  const shuffled = [...aptitudeQuestions].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, count);
};

export const evaluateAptitudeTest = (answers, questions) => {
  let correct = 0;
  const totalQuestions = questions.length;

  answers.forEach((answer, index) => {
    if (answer === questions[index].correctAnswer) {
      correct++;
    }
  });

  const score = Math.round((correct / totalQuestions) * 100);
  const passed = score >= 60;

  return {
    score,
    correct,
    totalQuestions,
    passed,
  };
};

export const evaluateCodingChallenge = (code, language, problemType) => {
  // Simple evaluation based on code content
  let passed = false;
  let feedback = "";

  if (language === "python") {
    if (code.includes("def factorial") && code.includes("return")) {
      if (code.includes("if n == 0") || code.includes("n == 0")) {
        passed = true;
        feedback =
          "Good implementation! You correctly handled the base case and used proper function structure.";
      } else {
        feedback = "Good start, but make sure to handle the base case for n=0.";
      }
    } else {
      feedback =
        "Make sure to define a function called 'factorial' that takes a parameter 'n'.";
    }
  } else if (language === "javascript") {
    if (code.includes("function isPalindrome") && code.includes("return")) {
      if (code.includes("toLowerCase") || code.includes("replace")) {
        passed = true;
        feedback =
          "Excellent! You properly handled case sensitivity and string cleaning.";
      } else {
        feedback =
          "Good function structure, but consider handling case sensitivity and removing spaces/punctuation.";
      }
    } else {
      feedback =
        "Make sure to define a function called 'isPalindrome' that takes a string parameter.";
    }
  } else if (language === "java") {
    if (
      code.includes("public static int findMax") &&
      code.includes("int[] arr")
    ) {
      if (code.includes("for") || code.includes("Math.max")) {
        passed = true;
        feedback =
          "Great job! You correctly implemented array traversal and maximum finding logic.";
      } else {
        feedback =
          "Good method signature, but you need to implement the logic to find the maximum value.";
      }
    } else {
      feedback =
        "Make sure to define a public static method called 'findMax' that takes an int array parameter.";
    }
  } else if (language === "cpp") {
    if (code.includes("int factorial") && code.includes("return")) {
      if (code.includes("if (n == 0)") || code.includes("n == 0")) {
        passed = true;
        feedback =
          "Good implementation! You correctly handled the base case and used proper function structure.";
      } else {
        feedback = "Good start, but make sure to handle the base case for n=0.";
      }
    } else {
      feedback =
        "Make sure to define a function called 'factorial' that takes an int parameter.";
    }
  } else if (language === "c") {
    if (code.includes("int factorial") && code.includes("return")) {
      if (code.includes("if (n == 0)") || code.includes("n == 0")) {
        passed = true;
        feedback =
          "Good implementation! You correctly handled the base case and used proper function structure.";
      } else {
        feedback = "Good start, but make sure to handle the base case for n=0.";
      }
    } else {
      feedback =
        "Make sure to define a function called 'factorial' that takes an int parameter.";
    }
  }

  return {
    passed,
    feedback,
    language,
  };
};

export const detectInterests = (answers) => {
  const interests = {
    frontend: 0,
    backend: 0,
    fullstack: 0,
    dataScience: 0,
    machineLearning: 0,
    devops: 0,
    mobile: 0,
    cybersecurity: 0,
    blockchain: 0,
    cloud: 0,
  };

  answers.forEach((answer) => {
    const lowerAnswer = answer.toLowerCase();

    // Frontend
    if (
      lowerAnswer.includes("frontend") ||
      lowerAnswer.includes("react") ||
      lowerAnswer.includes("vue") ||
      lowerAnswer.includes("angular") ||
      lowerAnswer.includes("html") ||
      lowerAnswer.includes("css") ||
      lowerAnswer.includes("javascript") ||
      lowerAnswer.includes("ui") ||
      lowerAnswer.includes("ux")
    ) {
      interests.frontend++;
    }

    // Backend
    if (
      lowerAnswer.includes("backend") ||
      lowerAnswer.includes("node") ||
      lowerAnswer.includes("express") ||
      lowerAnswer.includes("django") ||
      lowerAnswer.includes("flask") ||
      lowerAnswer.includes("api") ||
      lowerAnswer.includes("server") ||
      lowerAnswer.includes("database")
    ) {
      interests.backend++;
    }

    // Fullstack
    if (
      lowerAnswer.includes("fullstack") ||
      lowerAnswer.includes("full stack") ||
      (lowerAnswer.includes("frontend") && lowerAnswer.includes("backend"))
    ) {
      interests.fullstack++;
    }

    // Data Science
    if (
      lowerAnswer.includes("data science") ||
      lowerAnswer.includes("pandas") ||
      lowerAnswer.includes("numpy") ||
      lowerAnswer.includes("statistics") ||
      lowerAnswer.includes("analytics") ||
      lowerAnswer.includes("data analysis")
    ) {
      interests.dataScience++;
    }

    // Machine Learning
    if (
      lowerAnswer.includes("machine learning") ||
      lowerAnswer.includes("ml") ||
      lowerAnswer.includes("tensorflow") ||
      lowerAnswer.includes("pytorch") ||
      lowerAnswer.includes("neural") ||
      lowerAnswer.includes("deep learning") ||
      lowerAnswer.includes("ai") ||
      lowerAnswer.includes("artificial intelligence")
    ) {
      interests.machineLearning++;
    }

    // DevOps
    if (
      lowerAnswer.includes("devops") ||
      lowerAnswer.includes("docker") ||
      lowerAnswer.includes("kubernetes") ||
      lowerAnswer.includes("ci/cd") ||
      lowerAnswer.includes("jenkins") ||
      lowerAnswer.includes("aws") ||
      lowerAnswer.includes("azure") ||
      lowerAnswer.includes("deployment")
    ) {
      interests.devops++;
    }

    // Mobile
    if (
      lowerAnswer.includes("mobile") ||
      lowerAnswer.includes("android") ||
      lowerAnswer.includes("ios") ||
      lowerAnswer.includes("flutter") ||
      lowerAnswer.includes("react native") ||
      lowerAnswer.includes("swift") ||
      lowerAnswer.includes("kotlin")
    ) {
      interests.mobile++;
    }

    // Cybersecurity
    if (
      lowerAnswer.includes("cybersecurity") ||
      lowerAnswer.includes("security") ||
      lowerAnswer.includes("encryption") ||
      lowerAnswer.includes("hacking") ||
      lowerAnswer.includes("penetration") ||
      lowerAnswer.includes("firewall")
    ) {
      interests.cybersecurity++;
    }

    // Blockchain
    if (
      lowerAnswer.includes("blockchain") ||
      lowerAnswer.includes("bitcoin") ||
      lowerAnswer.includes("ethereum") ||
      lowerAnswer.includes("crypto") ||
      lowerAnswer.includes("smart contract") ||
      lowerAnswer.includes("web3")
    ) {
      interests.blockchain++;
    }

    // Cloud
    if (
      lowerAnswer.includes("cloud") ||
      lowerAnswer.includes("aws") ||
      lowerAnswer.includes("azure") ||
      lowerAnswer.includes("gcp") ||
      lowerAnswer.includes("serverless") ||
      lowerAnswer.includes("lambda")
    ) {
      interests.cloud++;
    }
  });

  return interests;
};

export const generateDynamicQuestions = (interests) => {
  const questions = [];

  // Frontend questions
  if (interests.frontend > 0) {
    questions.push({
      id: 9,
      question: "How would you optimize a slow-loading web page?",
      type: "technical",
      expectedKeywords: [
        "images",
        "caching",
        "minification",
        "cdn",
        "lazy loading",
        "webpack",
        "bundle splitting",
      ],
    });
    questions.push({
      id: 14,
      question: "Explain the difference between React state and props.",
      type: "technical",
      expectedKeywords: [
        "state",
        "props",
        "mutable",
        "immutable",
        "parent",
        "child",
        "lifecycle",
      ],
    });
  }

  // Backend questions
  if (interests.backend > 0) {
    questions.push({
      id: 10,
      question:
        "How do you handle database connections in a high-traffic application?",
      type: "technical",
      expectedKeywords: [
        "connection pooling",
        "scalability",
        "performance",
        "caching",
        "load balancing",
        "orm",
      ],
    });
    questions.push({
      id: 15,
      question: "Explain RESTful API design principles.",
      type: "technical",
      expectedKeywords: [
        "rest",
        "http methods",
        "stateless",
        "resources",
        "endpoints",
        "json",
      ],
    });
  }

  // Fullstack questions
  if (interests.fullstack > 0) {
    questions.push({
      id: 16,
      question:
        "How do you ensure data consistency between frontend and backend?",
      type: "technical",
      expectedKeywords: [
        "validation",
        "sanitization",
        "api contracts",
        "error handling",
        "data types",
        "serialization",
      ],
    });
  }

  // Data Science questions
  if (interests.dataScience > 0) {
    questions.push({
      id: 17,
      question:
        "Explain the difference between supervised and unsupervised learning.",
      type: "technical",
      expectedKeywords: [
        "labeled",
        "unlabeled",
        "classification",
        "regression",
        "clustering",
        "prediction",
        "training data",
      ],
    });
    questions.push({
      id: 18,
      question: "How do you handle missing data in a dataset?",
      type: "technical",
      expectedKeywords: [
        "imputation",
        "deletion",
        "mean",
        "median",
        "mode",
        "interpolation",
        "feature engineering",
      ],
    });
  }

  // Machine Learning questions
  if (interests.machineLearning > 0) {
    questions.push({
      id: 19,
      question:
        "What are the differences between overfitting and underfitting?",
      type: "technical",
      expectedKeywords: [
        "overfitting",
        "underfitting",
        "bias",
        "variance",
        "training accuracy",
        "validation accuracy",
        "generalization",
      ],
    });
    questions.push({
      id: 20,
      question: "Explain the concept of gradient descent.",
      type: "technical",
      expectedKeywords: [
        "optimization",
        "loss function",
        "learning rate",
        "convergence",
        "local minimum",
        "global minimum",
        "backpropagation",
      ],
    });
  }

  // DevOps questions
  if (interests.devops > 0) {
    questions.push({
      id: 21,
      question: "How do you implement CI/CD pipelines?",
      type: "technical",
      expectedKeywords: [
        "continuous integration",
        "continuous deployment",
        "automation",
        "testing",
        "deployment",
        "rollback",
        "monitoring",
      ],
    });
    questions.push({
      id: 22,
      question: "Explain container orchestration and its benefits.",
      type: "technical",
      expectedKeywords: [
        "kubernetes",
        "docker",
        "scaling",
        "load balancing",
        "service discovery",
        "self-healing",
        "resource management",
      ],
    });
  }

  // Mobile questions
  if (interests.mobile > 0) {
    questions.push({
      id: 23,
      question: "What are the key considerations for mobile app performance?",
      type: "technical",
      expectedKeywords: [
        "battery",
        "memory",
        "network",
        "ui responsiveness",
        "offline storage",
        "app size",
        "cpu usage",
      ],
    });
    questions.push({
      id: 24,
      question:
        "How do you handle different screen sizes and orientations in mobile apps?",
      type: "technical",
      expectedKeywords: [
        "responsive design",
        "adaptive layout",
        "constraints",
        "media queries",
        "orientation changes",
        "pixel density",
      ],
    });
  }

  // Cybersecurity questions
  if (interests.cybersecurity > 0) {
    questions.push({
      id: 25,
      question: "What are common web application security vulnerabilities?",
      type: "technical",
      expectedKeywords: [
        "sql injection",
        "xss",
        "csrf",
        "authentication",
        "authorization",
        "encryption",
        "input validation",
      ],
    });
    questions.push({
      id: 26,
      question: "How do you implement secure authentication?",
      type: "technical",
      expectedKeywords: [
        "oauth",
        "jwt",
        "password hashing",
        "salt",
        "session management",
        "multi-factor authentication",
        "ssl/tls",
      ],
    });
  }

  // Blockchain questions
  if (interests.blockchain > 0) {
    questions.push({
      id: 27,
      question:
        "Explain the difference between public and private blockchains.",
      type: "technical",
      expectedKeywords: [
        "public",
        "private",
        "permissioned",
        "permissionless",
        "consensus",
        "participants",
        "ethereum",
        "hyperledger",
      ],
    });
    questions.push({
      id: 28,
      question: "What are smart contracts and how do they work?",
      type: "technical",
      expectedKeywords: [
        "smart contracts",
        "self-executing",
        "blockchain",
        "ethereum",
        "solidity",
        "automated",
        "trustless",
      ],
    });
  }

  // Cloud questions
  if (interests.cloud > 0) {
    questions.push({
      id: 29,
      question: "How do you choose between different cloud service models?",
      type: "technical",
      expectedKeywords: [
        "iaas",
        "paas",
        "saas",
        "serverless",
        "scalability",
        "cost",
        "control",
        "maintenance",
      ],
    });
    questions.push({
      id: 30,
      question: "Explain cloud security best practices.",
      type: "technical",
      expectedKeywords: [
        "encryption",
        "access control",
        "monitoring",
        "compliance",
        "data protection",
        "network security",
        "identity management",
      ],
    });
  }

  // If no interests detected, add default questions to ensure we have enough questions
  if (questions.length === 0) {
    // Add some default questions from the interviewQuestions array (excluding the first one)
    questions.push(
      interviewQuestions[1], // Programming languages proficiency
      interviewQuestions[2], // OOP vs Functional programming
      interviewQuestions[3], // Challenging project experience
      interviewQuestions[4], // Debugging approach
      interviewQuestions[5], // Staying updated with technology
      interviewQuestions[6] // Time/Space complexity
    );
  }

  return questions;
};

export const evaluateInterviewAnswers = (answers) => {
  let score = 0;
  const totalQuestions = answers.length;

  answers.forEach((answer, index) => {
    if (!answer || answer.trim().length === 0) return;

    const question = interviewQuestions[index] || {};
    const answerLength = answer.length;
    const hasKeywords = question.expectedKeywords
      ? question.expectedKeywords.some((keyword) =>
          answer.toLowerCase().includes(keyword.toLowerCase())
        )
      : false;

    // Scoring based on length and keyword presence
    if (answerLength > 100 && hasKeywords) {
      score += 3; // Excellent answer
    } else if (answerLength > 50 && hasKeywords) {
      score += 2; // Good answer
    } else if (answerLength > 20) {
      score += 1; // Basic answer
    }
    // 0 for poor answers
  });

  const maxPossibleScore = totalQuestions * 3;
  const percentage =
    maxPossibleScore > 0 ? (score / maxPossibleScore) * 100 : 0;
  const passed = percentage >= 60;

  return {
    score: Math.round(percentage),
    correct: score,
    totalQuestions,
    passed,
  };
};

export const generateAptitudeAnalysis = (result, questions, answers) => {
  const { score, correct, totalQuestions } = result;

  let analysis = {
    strengths: [],
    weaknesses: [],
    recommendations: [],
  };

  // Check if questions and answers are provided
  if (!questions || !answers) {
    analysis.recommendations.push(
      "Unable to analyze aptitude performance - test data not available"
    );
    return analysis;
  }

  // Analyze performance by topic
  const topics = {
    mathematics: 0,
    dataStructures: 0,
    databases: 0,
    computerScience: 0,
  };

  questions.forEach((question, index) => {
    const isCorrect = answers[index] === question.correctAnswer;

    if (
      question.question.toLowerCase().includes("train") ||
      question.question.toLowerCase().includes("average") ||
      question.question.toLowerCase().includes("salary")
    ) {
      topics.mathematics += isCorrect ? 1 : 0;
    } else if (
      question.question.toLowerCase().includes("data structure") ||
      question.question.toLowerCase().includes("fifo")
    ) {
      topics.dataStructures += isCorrect ? 1 : 0;
    } else if (
      question.question.toLowerCase().includes("dbms") ||
      question.question.toLowerCase().includes("normal form")
    ) {
      topics.databases += isCorrect ? 1 : 0;
    } else {
      topics.computerScience += isCorrect ? 1 : 0;
    }
  });

  // Strengths
  if (topics.mathematics >= 1)
    analysis.strengths.push("Strong mathematical reasoning skills");
  if (topics.dataStructures >= 1)
    analysis.strengths.push("Good understanding of data structures");
  if (topics.databases >= 1)
    analysis.strengths.push("Solid database concepts knowledge");
  if (topics.computerScience >= 1)
    analysis.strengths.push("Strong computer science fundamentals");

  // Weaknesses
  if (topics.mathematics === 0)
    analysis.weaknesses.push("Need to improve mathematical problem-solving");
  if (topics.dataStructures === 0)
    analysis.weaknesses.push("Data structures concepts need strengthening");
  if (topics.databases === 0)
    analysis.weaknesses.push("Database management concepts require more study");
  if (topics.computerScience === 0)
    analysis.weaknesses.push("Computer science fundamentals need review");

  // Recommendations
  if (score < 60) {
    analysis.recommendations.push("Practice more aptitude questions daily");
    analysis.recommendations.push(
      "Focus on understanding basic concepts before attempting questions"
    );
  } else if (score < 80) {
    analysis.recommendations.push("Work on time management during tests");
    analysis.recommendations.push("Review weak topic areas identified above");
  } else {
    analysis.recommendations.push("Maintain consistent practice to stay sharp");
    analysis.recommendations.push("Try more advanced aptitude problems");
  }

  return analysis;
};

export const generateCodingAnalysis = (result, language, code) => {
  const { passed } = result;

  let analysis = {
    strengths: [],
    weaknesses: [],
    recommendations: [],
  };

  if (passed) {
    analysis.strengths.push(
      `Good understanding of ${language} syntax and structure`
    );
    analysis.strengths.push("Able to implement algorithmic logic correctly");

    if (code.includes("if") || code.includes("for") || code.includes("while")) {
      analysis.strengths.push("Proper use of control structures");
    }

    if (language === "python" && code.includes("def")) {
      analysis.strengths.push("Good function definition practices");
    } else if (language === "javascript" && code.includes("function")) {
      analysis.strengths.push("Proper function declaration");
    } else if (language === "java" && code.includes("public static")) {
      analysis.strengths.push("Correct method signature and modifiers");
    }

    analysis.recommendations.push(
      "Continue practicing different problem types"
    );
    analysis.recommendations.push("Try implementing more complex algorithms");
  } else {
    analysis.weaknesses.push("Code logic needs debugging and correction");

    if (
      !code.includes("function") &&
      !code.includes("def") &&
      !code.includes("public static")
    ) {
      analysis.weaknesses.push("Missing proper function/method definition");
    }

    if (!code.includes("return")) {
      analysis.weaknesses.push("Missing return statement in function");
    }

    analysis.recommendations.push(
      "Review basic syntax and structure for the chosen language"
    );
    analysis.recommendations.push("Practice with simpler problems first");
    analysis.recommendations.push(
      "Use debugging tools to understand code flow"
    );
  }

  return analysis;
};

export const generateInterviewAnalysis = (
  result,
  answers,
  questions = interviewQuestions
) => {
  const { score, totalQuestions, passed } = result;

  let analysis = {
    overallAssessment: "",
    strengths: [],
    weaknesses: [],
    recommendations: [],
    communicationSkills: [],
    technicalDepth: [],
    aiInsights: "",
    nextSteps: [],
  };

  // Overall assessment
  const percentage = (score / totalQuestions) * 100;
  if (percentage >= 80) {
    analysis.overallAssessment =
      "Outstanding interview performance! You demonstrated excellent communication and technical skills.";
  } else if (percentage >= 60) {
    analysis.overallAssessment =
      "Good interview performance with strong potential. Focus on consistency across all questions.";
  } else if (percentage >= 40) {
    analysis.overallAssessment =
      "Average interview performance. Work on providing more detailed and relevant answers.";
  } else {
    analysis.overallAssessment =
      "Interview performance needs significant improvement. Practice structured responses and technical concepts.";
  }

  // Analyze answers
  answers.forEach((answer, index) => {
    if (!answer || answer.trim().length === 0) return;

    const question = questions[index] || {};
    const answerLength = answer.length;
    const hasKeywords = question.expectedKeywords
      ? question.expectedKeywords.some((keyword) =>
          answer.toLowerCase().includes(keyword.toLowerCase())
        )
      : false;

    // Communication analysis
    if (answerLength > 100) {
      analysis.communicationSkills.push(
        `Question ${index + 1}: Detailed and comprehensive response`
      );
    } else if (answerLength > 50) {
      analysis.communicationSkills.push(
        `Question ${index + 1}: Good response length`
      );
    } else {
      analysis.weaknesses.push(
        `Question ${index + 1}: Response could be more detailed`
      );
    }

    // Technical depth analysis
    if (question.type === "technical") {
      if (hasKeywords && answerLength > 80) {
        analysis.technicalDepth.push(
          `Question ${index + 1}: Strong technical explanation`
        );
      } else if (hasKeywords) {
        analysis.technicalDepth.push(
          `Question ${index + 1}: Basic technical understanding`
        );
      } else {
        analysis.technicalDepth.push(
          `Question ${index + 1}: Needs more technical depth`
        );
      }
    }
  });

  // Strengths and weaknesses
  const avgAnswerLength =
    answers.reduce((sum, ans) => sum + (ans ? ans.length : 0), 0) /
    answers.length;
  if (avgAnswerLength > 80) {
    analysis.strengths.push(
      "Good communication skills with detailed responses"
    );
  } else if (avgAnswerLength < 40) {
    analysis.weaknesses.push(
      "Responses are too brief - expand on your answers"
    );
  }

  const technicalScore = answers.filter((answer, index) => {
    const question = questions[index];
    return (
      question &&
      question.type === "technical" &&
      answer &&
      question.expectedKeywords &&
      question.expectedKeywords.some((keyword) =>
        answer.toLowerCase().includes(keyword.toLowerCase())
      )
    );
  }).length;

  const totalTechnical = questions.filter(
    (q) => q && q.type === "technical"
  ).length;
  const technicalPercentage =
    totalTechnical > 0 ? (technicalScore / totalTechnical) * 100 : 0;

  if (technicalPercentage >= 75) {
    analysis.strengths.push(
      "Strong technical knowledge and explanation skills"
    );
  } else if (technicalPercentage < 50) {
    analysis.weaknesses.push(
      "Technical explanations need more depth and accuracy"
    );
  }

  // AI Insights
  if (passed) {
    analysis.aiInsights =
      "Your interview responses show good preparation and communication skills. Continue practicing to refine your delivery.";
  } else {
    analysis.aiInsights =
      "Focus on understanding key technical concepts and practicing structured responses. Use the STAR method for behavioral questions.";
  }

  // Recommendations
  analysis.recommendations = [
    "Practice answering common interview questions out loud",
    "Use the STAR method (Situation, Task, Action, Result) for behavioral questions",
    "Research company-specific technologies and prepare relevant examples",
    "Record yourself answering questions to improve delivery and confidence",
  ];

  // Next steps
  analysis.nextSteps = [
    "Review technical concepts mentioned in the questions",
    "Practice mock interviews with friends or mentors",
    "Prepare specific examples from your experience",
    "Work on speaking clearly and confidently",
  ];

  return analysis;
};

// Comprehensive analysis generator for all completed tests
export const generateComprehensiveAnalysis = (scores, testData = {}) => {
  const completedTests = [];
  let totalScore = 0;
  let totalPossible = 0;

  // Check which tests are completed
  if (scores.aptitude !== null) {
    completedTests.push("aptitude");
    totalScore += scores.aptitude.score || 0;
    totalPossible += 100;
  }
  if (scores.coding !== null) {
    completedTests.push("coding");
    totalScore += scores.coding.passed ? 100 : 0;
    totalPossible += 100;
  }
  if (scores.interview !== null) {
    completedTests.push("interview");
    const interviewScore =
      (scores.interview.score / scores.interview.totalQuestions) * 100;
    totalScore += interviewScore;
    totalPossible += 100;
  }

  const overallPercentage =
    totalPossible > 0 ? (totalScore / totalPossible) * 100 : 0;

  let analysis = {
    overallAssessment: "",
    testBreakdown: [],
    strengths: [],
    weaknesses: [],
    recommendations: [],
    aiInsights: "",
    nextSteps: [],
    completedTests: completedTests.length,
    totalTests: 3,
    overallScore: overallPercentage,
  };

  // Overall assessment based on completion and performance
  if (completedTests.length === 3) {
    if (overallPercentage >= 80) {
      analysis.overallAssessment =
        "Outstanding performance across all placement tests! You demonstrated exceptional skills in aptitude, coding, and interview rounds.";
    } else if (overallPercentage >= 60) {
      analysis.overallAssessment =
        "Strong performance with good potential for placement success. You have solid technical foundations.";
    } else if (overallPercentage >= 40) {
      analysis.overallAssessment =
        "Decent performance with room for improvement. Focus on weak areas before interviews.";
    } else {
      analysis.overallAssessment =
        "Performance needs significant improvement. Consider additional preparation and practice.";
    }
  } else {
    analysis.overallAssessment = `Completed ${
      completedTests.length
    } out of 3 tests. ${
      completedTests.length === 0
        ? "Start with the aptitude test to begin your placement preparation."
        : completedTests.length === 1
        ? "Continue with the remaining tests to get a complete assessment."
        : "Complete the final test for comprehensive feedback."
    }`;
  }

  // Test breakdown
  if (scores.aptitude !== null) {
    const aptitudeScore = scores.aptitude.score || 0;
    analysis.testBreakdown.push({
      test: "Aptitude Test",
      score: aptitudeScore,
      status: aptitudeScore >= 60 ? "Passed" : "Failed",
      feedback:
        aptitudeScore >= 80
          ? "Excellent analytical skills"
          : aptitudeScore >= 60
          ? "Good foundation"
          : "Needs improvement",
    });
  }

  if (scores.coding !== null) {
    const codingPassed = scores.coding.passed;
    analysis.testBreakdown.push({
      test: "Coding Challenge",
      score: codingPassed ? 100 : 0,
      status: codingPassed ? "Passed" : "Failed",
      feedback: codingPassed
        ? "Good programming fundamentals"
        : "Code needs debugging",
    });
  }

  if (scores.interview !== null) {
    const interviewScore =
      (scores.interview.score / scores.interview.totalQuestions) * 100;
    analysis.testBreakdown.push({
      test: "Interview",
      score: interviewScore,
      status: interviewScore >= 60 ? "Passed" : "Failed",
      feedback:
        interviewScore >= 80
          ? "Strong communication skills"
          : interviewScore >= 60
          ? "Good responses"
          : "Needs more detail",
    });
  }

  // Generate detailed analysis for each completed test
  if (scores.aptitude !== null && testData.aptitude) {
    const aptitudeAnalysis = generateAptitudeAnalysis(
      scores.aptitude,
      testData.aptitude.questions,
      testData.aptitude.answers
    );
    analysis.strengths.push(...aptitudeAnalysis.strengths);
    analysis.weaknesses.push(...aptitudeAnalysis.weaknesses);
  }

  if (scores.coding !== null && testData.coding) {
    const codingAnalysis = generateCodingAnalysis(
      scores.coding,
      testData.coding.language,
      testData.coding.code
    );
    analysis.strengths.push(...codingAnalysis.strengths);
    analysis.weaknesses.push(...codingAnalysis.weaknesses);
  }

  if (scores.interview !== null && testData.interview) {
    const interviewAnalysis = generateInterviewAnalysis(
      scores.interview,
      testData.interview.answers
    );
    analysis.strengths.push(...interviewAnalysis.strengths);
    analysis.weaknesses.push(...interviewAnalysis.weaknesses);
  }

  // AI Insights based on overall performance
  if (completedTests.length === 3) {
    if (overallPercentage >= 80) {
      analysis.aiInsights =
        "You have excellent placement potential! Your comprehensive skill set across all areas makes you a strong candidate for technical roles.";
    } else if (overallPercentage >= 60) {
      analysis.aiInsights =
        "Good overall performance with balanced skills. Focus on weak areas to become a well-rounded candidate.";
    } else {
      analysis.aiInsights =
        "Significant improvement needed across multiple areas. Create a structured study plan focusing on fundamentals.";
    }
  } else {
    analysis.aiInsights = `Analysis based on ${
      completedTests.length
    } completed test${
      completedTests.length !== 1 ? "s" : ""
    }. Complete all tests for comprehensive feedback.`;
  }

  // Recommendations based on performance
  if (analysis.weaknesses.length > 0) {
    analysis.recommendations.push(
      `Address weaknesses in: ${analysis.weaknesses.slice(0, 3).join(", ")}`
    );
  }

  if (completedTests.length < 3) {
    analysis.recommendations.push(
      "Complete all remaining tests for a full assessment of your placement readiness"
    );
  }

  if (overallPercentage < 60) {
    analysis.recommendations.push(
      "Focus on building fundamental concepts through structured learning and practice"
    );
    analysis.recommendations.push(
      "Consider online courses or bootcamps for weak areas"
    );
  } else {
    analysis.recommendations.push(
      "Practice with real-world projects to apply your knowledge"
    );
    analysis.recommendations.push(
      "Prepare for company-specific interviews and coding challenges"
    );
  }

  // Next steps
  analysis.nextSteps = [
    "Review detailed feedback for each completed test",
    "Practice consistently in weak areas identified",
    "Take mock tests to improve speed and accuracy",
    "Build projects to demonstrate practical skills",
  ];

  if (completedTests.length < 3) {
    analysis.nextSteps.unshift("Complete remaining placement tests");
  }

  return analysis;
};
